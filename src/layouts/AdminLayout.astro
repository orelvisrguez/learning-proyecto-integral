---
interface Props {
  title: string;
  activeTab?: 'novedades' | 'mensajes';
}

const { title, activeTab = 'novedades' } = Astro.props;

const navItems = [
  {
    id: 'novedades',
    label: 'Novedades',
    href: '/admin',
    icon: 'M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z'
  },
  {
    id: 'mensajes',
    label: 'Mensajes',
    href: '/admin/mensajes',
    icon: 'M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z'
  }
];
---

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex, nofollow" />
  <title>{title} - Learning Admin</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
</head>
<body class="font-sans antialiased bg-gray-50">
  <!-- Loading State -->
  <div id="loading-state" class="fixed inset-0 z-50 flex items-center justify-center bg-gray-50">
    <div class="text-center">
      <div class="w-16 h-16 bg-gradient-to-br from-primary-600 to-primary-700 rounded-2xl flex items-center justify-center shadow-xl mx-auto mb-4 animate-pulse">
        <span class="text-white font-display font-bold text-2xl">L</span>
      </div>
      <div class="flex items-center gap-2 text-gray-500">
        <svg class="animate-spin w-5 h-5" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <span class="font-medium">Cargando panel...</span>
      </div>
    </div>
  </div>

  <!-- Main Admin Interface -->
  <div id="admin-app" class="hidden min-h-screen flex">
    <!-- Sidebar -->
    <aside class="fixed inset-y-0 left-0 w-64 bg-white border-r border-gray-200 z-40 hidden lg:block">
      <!-- Logo -->
      <div class="h-16 flex items-center px-6 border-b border-gray-100">
        <a href="/admin" class="flex items-center gap-3">
          <div class="w-10 h-10 bg-gradient-to-br from-primary-600 to-primary-700 rounded-xl flex items-center justify-center shadow-lg">
            <span class="text-white font-display font-bold text-lg">L</span>
          </div>
          <div>
            <span class="font-display font-bold text-gray-900 block leading-tight">Learning</span>
            <span class="text-xs text-gray-500">Panel Admin</span>
          </div>
        </a>
      </div>

      <!-- Navigation -->
      <nav class="p-4 space-y-1">
        {navItems.map(item => (
          <a
            href={item.href}
            class={`flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all ${
              activeTab === item.id
                ? 'bg-primary-50 text-primary-700 shadow-sm'
                : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900'
            }`}
          >
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d={item.icon} />
            </svg>
            <span>{item.label}</span>
            {item.id === 'mensajes' && (
              <span id="mensajes-badge" class="hidden ml-auto px-2 py-0.5 bg-red-500 text-white text-xs rounded-full font-bold">0</span>
            )}
          </a>
        ))}
      </nav>

      <!-- Bottom Section -->
      <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-100">
        <a
          href="/"
          target="_blank"
          class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-600 hover:bg-gray-50 hover:text-gray-900 transition-all font-medium"
        >
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
          </svg>
          <span>Ver sitio web</span>
        </a>
        <button
          id="logout-btn"
          class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-red-600 hover:bg-red-50 transition-all font-medium mt-1"
        >
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
          </svg>
          <span>Cerrar sesión</span>
        </button>
      </div>
    </aside>

    <!-- Mobile Header -->
    <header class="fixed top-0 left-0 right-0 h-16 bg-white border-b border-gray-200 z-30 lg:hidden flex items-center justify-between px-4">
      <div class="flex items-center gap-3">
        <button id="mobile-menu-btn" class="p-2 hover:bg-gray-100 rounded-lg">
          <svg class="w-6 h-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
        <span class="font-display font-bold text-gray-900">Learning Admin</span>
      </div>
      <button id="logout-btn-mobile" class="p-2 text-red-600 hover:bg-red-50 rounded-lg">
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
        </svg>
      </button>
    </header>

    <!-- Mobile Sidebar Overlay -->
    <div id="mobile-sidebar" class="fixed inset-0 z-50 hidden lg:hidden">
      <div class="absolute inset-0 bg-black/50" id="mobile-overlay"></div>
      <aside class="absolute inset-y-0 left-0 w-64 bg-white shadow-2xl">
        <div class="h-16 flex items-center justify-between px-6 border-b border-gray-100">
          <span class="font-display font-bold text-gray-900">Menú</span>
          <button id="close-mobile-menu" class="p-2 hover:bg-gray-100 rounded-lg">
            <svg class="w-5 h-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        <nav class="p-4 space-y-1">
          {navItems.map(item => (
            <a
              href={item.href}
              class={`flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all ${
                activeTab === item.id
                  ? 'bg-primary-50 text-primary-700'
                  : 'text-gray-600 hover:bg-gray-50'
              }`}
            >
              <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d={item.icon} />
              </svg>
              <span>{item.label}</span>
            </a>
          ))}
        </nav>
      </aside>
    </div>

    <!-- Main Content -->
    <main class="flex-1 lg:ml-64 pt-16 lg:pt-0 min-h-screen">
      <slot />
    </main>
  </div>

  <style is:global>
    :root {
      --color-primary-50: #eff6ff;
      --color-primary-100: #dbeafe;
      --color-primary-200: #bfdbfe;
      --color-primary-500: #3b82f6;
      --color-primary-600: #2563eb;
      --color-primary-700: #1d4ed8;
    }

    body {
      font-family: 'Plus Jakarta Sans', system-ui, sans-serif;
    }

    .font-display {
      font-family: 'Plus Jakarta Sans', system-ui, sans-serif;
    }

    .input-field {
      @apply w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-primary-500 focus:ring-2 focus:ring-primary-100 outline-none transition-all text-gray-900 placeholder:text-gray-400;
    }

    .btn-primary {
      @apply inline-flex items-center gap-2 px-5 py-3 bg-primary-600 hover:bg-primary-700 text-white font-semibold rounded-xl transition-all shadow-lg shadow-primary-500/25 hover:shadow-xl hover:shadow-primary-500/30 hover:-translate-y-0.5;
    }

    .btn-secondary {
      @apply inline-flex items-center gap-2 px-5 py-3 bg-white border border-gray-200 text-gray-700 font-semibold rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all;
    }

    .btn-accent {
      @apply inline-flex items-center gap-2 px-5 py-3 bg-gradient-to-r from-accent-500 to-accent-600 text-white font-semibold rounded-xl transition-all shadow-lg hover:shadow-xl hover:-translate-y-0.5;
    }

    .btn-danger {
      @apply inline-flex items-center gap-2 px-5 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-xl transition-all;
    }

    .card {
      @apply bg-white rounded-2xl border border-gray-100 shadow-sm;
    }
  </style>

  <script>
    import { getCurrentUser, signOut } from '@lib/auth';

    // Check authentication
    async function checkAuth() {
      const user = await getCurrentUser();
      if (!user) {
        window.location.href = '/admin/login';
        return;
      }
      document.getElementById('loading-state')?.classList.add('hidden');
      document.getElementById('admin-app')?.classList.remove('hidden');
    }

    // Logout handlers
    document.getElementById('logout-btn')?.addEventListener('click', async () => {
      await signOut();
      window.location.href = '/admin/login';
    });

    document.getElementById('logout-btn-mobile')?.addEventListener('click', async () => {
      await signOut();
      window.location.href = '/admin/login';
    });

    // Mobile menu
    const mobileSidebar = document.getElementById('mobile-sidebar');
    document.getElementById('mobile-menu-btn')?.addEventListener('click', () => {
      mobileSidebar?.classList.remove('hidden');
    });
    document.getElementById('close-mobile-menu')?.addEventListener('click', () => {
      mobileSidebar?.classList.add('hidden');
    });
    document.getElementById('mobile-overlay')?.addEventListener('click', () => {
      mobileSidebar?.classList.add('hidden');
    });

    checkAuth();
  </script>
</body>
</html>
